<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Wajbzz - Music</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&display=swap" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body, html { height:100%; background:#000; color:#3ec1e0; font-family:'Orbitron',sans-serif; }
nav { background:#0f0f0f; display:flex; justify-content:center; padding:1rem 0; position:sticky; top:0; z-index:10; }
nav a { color:#3ec1e0; text-decoration:none; margin:0 1.5rem; font-size:1.1rem; transition:color .3s; display:flex; align-items:center; gap:.3rem; }
nav a:hover { color:#00ffff; }
.social-buttons { position:fixed; bottom:1rem; left:1rem; display:flex; gap:.5rem; z-index:10000; }
.social-buttons a { background:#111; border:2px solid #3ec1e0; color:#3ec1e0; width:36px; height:36px; display:flex; align-items:center; justify-content:center; border-radius:6px; transition:all .3s; }
.social-buttons a:hover { background:#00ffff; color:#000; border-color:#00ffff; }
.lang-buttons { position:fixed; top:1rem; right:1rem; display:flex; gap:.5rem; z-index:10000; }
.lang-buttons button { background:none; border:2px solid #3ec1e0; color:#3ec1e0; font-family:'Orbitron',sans-serif; cursor:pointer; padding:.3rem .8rem; font-size:.9rem; border-radius:4px; transition:background .3s,color .3s; }
.lang-buttons button.active, .lang-buttons button:hover { background:#00ffff; color:#000; border-color:#00ffff; }
main { max-width:1100px; margin:3rem auto 5rem; padding:0 1rem; }
h1 { font-size:2.8rem; text-align:center; margin-bottom:1.5rem; text-shadow:0 0 8px #00ffff; }
.featured-section {
  background: linear-gradient(90deg, #232949 70%, #3ec1e0 100%);
  border-radius: 12px;
  margin-bottom: 2.2em;
  box-shadow: 0 2px 18px #00ffff33;
  display: flex;
  align-items: center;
  padding: 1.6em;
  gap: 2em;
}
.featured-thumb {
  width: 148px;
  height: 84px;
  border-radius: 8px;
  box-shadow: 0 0 12px #00ffff99, 0 0 3px #000;
  cursor: pointer;
  outline: none;
  border: 2px solid transparent;
  object-fit: cover;
  transition: border-color 0.15s;
}
.featured-thumb:focus, .featured-thumb:hover { border-color: #00ffff; }
.featured-info { flex: 1; }
.featured-info h2 {
  margin: 0 0 0.3em 0;
  color: #00ffff;
  font-size: 1.35rem;
}
.featured-info p { margin: 0; color: #e1eaff; }
.filters {
  display: flex;
  gap: 1em;
  align-items: center;
  margin-bottom: 1.5em;
  flex-wrap: wrap;
  justify-content: center;
}
#search-bar {
  padding: 0.5rem 1rem;
  border-radius: 4px;
  border: 2px solid #3ec1e0;
  background: #111;
  color: #3ec1e0;
  font-size: 1em;
  min-width: 180px;
  font-family: 'Orbitron',sans-serif;
  outline: none;
  transition: border-color 0.3s;
}
#search-bar:focus { border-color: #00ffff; }
#genre-filter {
  padding: 0.4em 0.8em;
  border-radius: 4px;
  border: 2px solid #3ec1e0;
  background: #111;
  color: #3ec1e0;
  font-size: 1em;
  font-family:'Orbitron',sans-serif;
}
#alphabet-filter {
  display: flex;
  gap: 0.2em;
  flex-wrap: wrap;
}
#alphabet-filter button {
  background: #232949;
  color: #fff;
  border: none;
  border-radius: 3px;
  padding: 0.2em 0.5em;
  font-size: 1em;
  cursor: pointer;
  transition: background 0.15s;
  font-family:'Orbitron',sans-serif;
}
#alphabet-filter button.active,
#alphabet-filter button:focus {
  background: #00ffff;
  color: #232949;
  font-weight: bold;
  outline: none;
}
.section-header {
  color: #3ec1e0;
  font-size: 1.25rem;
  margin-top: 1.7em;
  margin-bottom: 0.7em;
  letter-spacing: 1px;
  text-shadow:0 0 6px #00ffffaa;
}
#tracks-container, #videos-container {
  display: flex;
  gap: 1.7em;
  flex-wrap: wrap;
  min-height: 60px;
  align-items: stretch;
  justify-content: center;
}
.track-item {
  background: #181c2f;
  border-radius: 10px;
  padding: 1.1em 1.3em 1em 1.3em;
  box-shadow: 0 2px 8px #00ffff22;
  margin-bottom: 1.3em;
  min-width: 220px;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  width: 300px;
}
.track-info { margin-bottom: 0.4em; }
.track-title {
  font-weight: bold;
  font-size: 1.05rem;
  margin-bottom: 0.18em;
  color: #00ffff;
  display: flex;
  align-items: center;
  gap: 0.5em;
}
.track-artist { margin: 0; color: #e1eaff; font-size: 0.95rem; }
.track-genre {
  display: inline-block;
  background: #232949;
  color: #fff;
  border-radius: 4px;
  padding: 0 0.5em;
  font-size: 0.8em;
  margin-left: 0.6em;
  font-weight: 400;
}
.track-audio { width: 100%; margin-top: 0.5em; }
#videos-container { gap: 1.5em; margin-bottom: 2em; }
.video-thumb {
  width: 160px;
  height: 90px;
  border-radius: 8px;
  box-shadow: 0 0 12px #00ffff99, 0 0 3px #000;
  cursor: pointer;
  outline: none;
  border: 2px solid transparent;
  object-fit: cover;
  transition: border-color 0.15s;
}
.video-thumb:focus, .video-thumb:hover { border-color: #00ffff; }
#video-modal {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(10,20,30,0.93);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  transition: opacity 0.18s;
}
#video-modal.active { display: flex; }
#video-modal .close-btn {
  position: absolute;
  top: 3vw;
  right: 4vw;
  background: #222b4b;
  color: #fff;
  border: none;
  font-size: 2.2rem;
  border-radius: 7px;
  padding: 0.1em 0.32em;
  cursor: pointer;
  z-index: 1001;
  transition: background 0.16s;
}
#video-modal .close-btn:hover, #video-modal .close-btn:focus {
  background: #00ffff;
  color: #222b4b;
}
#admin-settings-trigger {
  position: fixed;
  right: 22px;
  bottom: 80px;
  text-align: right;
  padding: 1rem;
  z-index: 110;
  cursor:pointer;
}
.footer-bottom-right {
  position: fixed;
  right: 0;
  bottom: 0;
  padding: 10px 18px;
  color: #3ec1e0;
  font-size: .9rem;
  background: #0f0f0f;
  border-top-left-radius: 10px;
  z-index: 100;
  border-top: 1px solid #222;
  border-left: 1px solid #222;
  text-align: right;
  box-shadow: 0 0 10px #00ffff22;
}
#admin-modal-overlay {
  display: none;
  position: fixed;
  top:0;left:0;width:100vw;height:100vh;
  background:rgba(0,0,0,0.9);
  z-index:100000;
  justify-content:center;
  align-items:center;
}
#admin-modal-inner {
  background:#111;
  border:2px solid #00ffff;
  padding:2rem;
  border-radius:10px;
  max-width:900px;
  width:95%;
  text-align:left;
  box-shadow:0 0 20px #00ffffaa;
  max-height:90vh;
  overflow-y:auto;
  position:relative;
}
.pagination { text-align: center; margin:1.5em 0; }
.pagination button {
  margin: 0 3px;
  background: #232949;
  color: #fff;
  border: none;
  border-radius: 3px;
  padding: 0.2em 0.9em;
  font-size: 1em;
  cursor: pointer;
  transition: background 0.15s;
  font-family:'Orbitron',sans-serif;
  outline: none;
}
.pagination button.active,
.pagination button:focus {
  background: #00ffff;
  color: #232949;
  font-weight: bold;
}
@media (max-width: 800px) {
  main { max-width: 100%; }
  .featured-section { flex-direction: column; gap: 1em; padding: 1em; text-align: center; }
  .featured-info { width: 100%; }
  .track-item, .video-thumb { width: 95vw; min-width: 0; }
  #videos-container { justify-content: center; }
  #admin-modal-inner { max-width:98vw;padding:1em;}
}
@media (max-width: 700px) {
  nav {
    flex-direction: column;
    gap: 0.4rem;
    padding: 0.8rem 0;
  }
  nav a {
    margin: 0.4rem 0;
    font-size: 1.2rem;
  }
  main {
    margin: 1rem auto 3rem;
    padding: 0 .2rem;
    max-width: 100vw;
  }
  h1 {
    font-size: 2rem;
  }
  .featured-section {
    flex-direction: column;
    gap: 0.7em;
    padding: 0.7em;
    text-align: center;
  }
  .featured-thumb {
    width: 96px;
    height: 54px;
  }
  .filters {
    flex-direction: column;
    gap: 0.5em;
    padding: 0.2em 0;
  }
  .track-item,
  .video-thumb {
    width: 98vw;
    min-width: 0;
    max-width: 100vw;
    margin-left: 0;
    margin-right: 0;
  }
  #tracks-container,
  #videos-container {
    flex-direction: column;
    gap: 0.8em;
    align-items: stretch;
  }
  #videos-container {
    gap: 0.7em;
    margin-bottom: 1em;
  }
  .track-info {
    font-size: 0.98rem;
  }
  .section-header {
    font-size: 1.1rem;
    margin-top: 1.1em;
    margin-bottom: 0.5em;
  }
  .footer-bottom-right {
    left: 0;
    right: 0;
    bottom: 0;
    border-radius: 0;
    text-align: center;
    font-size: 0.95rem;
    background: #000a;
    padding: 0.3rem 0;
  }
  .social-buttons {
    left: 50%;
    bottom: 0.7rem;
    transform: translateX(-50%);
  }
  .lang-buttons {
    top: auto;
    bottom: 3.5rem;
    right: 50%;
    transform: translateX(50%);
    flex-direction: row;
  }
  #admin-settings-trigger {
    right: 10px;
    bottom: 3.9rem;
    padding: 0.7rem;
  }
  #admin-modal-inner {
    max-width: 99vw;
    padding: 0.6em;
  }
}
@media (max-width: 420px) {
  h1 { font-size: 1.16rem; }
  .featured-thumb { width: 72px; height: 40px; }
  .track-item { padding: 0.7em 0.6em 0.7em 0.6em; font-size: 0.92rem;}
  .footer-bottom-right { font-size: 0.85rem; }
  .social-buttons a {
    width: 30px;
    height: 30px;
    font-size: 0.95rem;
  }
  .lang-buttons button {
    font-size: 0.8rem;
    padding: 0.2rem 0.5rem;
  }
  #admin-settings-trigger {
    font-size: 1.1rem;
    bottom: 3.7rem;
  }
  #admin-modal-inner { padding: 0.2em; font-size: 0.92rem;}
}
</style>
</head>
<body>
<nav>
<a href="index.html" data-key="start"><i class="fas fa-home"></i><span>Start</span></a>
<a href="reviews.html" data-key="reviews"><i class="fas fa-star"></i><span>Reviews</span></a>
<a href="interviews.html" data-key="interviews"><i class="fas fa-microphone"></i><span>Interviews</span></a>
<a href="music.html" data-key="music"><i class="fas fa-music"></i><span>Music</span></a>
<a href="events.html" data-key="events"><i class="fas fa-calendar-alt"></i><span>Events</span></a>
<a href="team.html" data-key="team"><i class="fas fa-users"></i><span>Team</span></a>
<a href="contact.html" data-key="contact"><i class="fas fa-envelope"></i><span>Contact</span></a>
</nav>
<main>
<div class="featured-section" id="featured-section"></div>
<div class="filters">
  <input type="text" id="search-bar" placeholder="Search..." autocomplete="off" />
  <label for="genre-filter" style="margin-right:0.2em;" data-key="filter-genre-label">Filter by genre:</label>
  <select id="genre-filter"></select>
  <div id="alphabet-filter"></div>
</div>
<h3 class="section-header" data-key="tracks">Tracks</h3>
<div id="tracks-container"></div>
<div id="tracks-pagination" class="pagination"></div>
<h3 class="section-header" data-key="videos">Videos</h3>
<div id="videos-container"></div>
<div id="videos-pagination" class="pagination"></div>
</main>
<div class="social-buttons">
<a href="https://www.facebook.com/wajbzz" target="_blank"><i class="fab fa-facebook-f"></i></a>
<a href="https://www.instagram.com/wajbzz/" target="_blank"><i class="fab fa-instagram"></i></a>
<a href="https://www.youtube.com/@wajbzz" target="_blank"><i class="fab fa-youtube"></i></a>
</div>
<div class="lang-buttons">
<button id="btn-en" class="active">EN</button>
<button id="btn-pl">PL</button>
</div>
<div id="admin-settings-trigger" tabindex="0" aria-label="Admin Panel">
<i class="fas fa-cog" style="color:#3ec1e0;font-size:1.5rem;" title="Admin Panel"></i>
</div>
<div class="footer-bottom-right">
  © 2025 Wajbzz
</div>
<div id="video-modal"></div>
<div id="admin-modal-overlay">
  <div id="admin-modal-inner"></div>
</div>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, onSnapshot, getDocs, setDoc } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyB1fqIY7SHsCJ5sTpYURQycEBzaNRIbCFs",
  authDomain: "wajbzz-website.firebaseapp.com",
  projectId: "wajbzz-website",
  storageBucket: "wajbzz-website.firebasestorage.app",
  messagingSenderId: "387063007187",
  appId: "1:387063007187:web:2929f1a25716ca1ea71126",
  measurementId: "G-7F5F1YLRF2"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// --- DATA STATE ---
let tracksData = [];
let videosData = [];
let userGenres = [];
let featured = {type: "video", id: ""};
const TRACKS_PER_PAGE = 10;
const VIDEOS_PER_PAGE = 10;
let tracksPage = 1;
let videosPage = 1;

// --- REALTIME LISTENERS ---
function listenAllFirestore() {
  onSnapshot(collection(db, "tracks"), (snapshot) => {
    tracksData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
    if (tracksPage > Math.ceil(tracksData.length / TRACKS_PER_PAGE)) tracksPage = 1;
    displayTracks();
    updateTracksPagination();
    if (featured.type === "track" && !tracksData.find(t => t.id === featured.id)) {
      featured = {type: "video", id: videosData[0]?.id || ""};
      saveFeaturedToFirestore();
    }
    renderFeaturedSection();
    if (window.renderAdminTracks) renderAdminTracks(tracksData);
  });
  onSnapshot(collection(db, "videos"), (snapshot) => {
    videosData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
    if (videosPage > Math.ceil(videosData.length / VIDEOS_PER_PAGE)) videosPage = 1;
    displayVideos();
    updateVideosPagination();
    if (featured.type === "video" && !videosData.find(v => v.id === featured.id)) {
      featured = {type: "track", id: tracksData[0]?.id || ""};
      saveFeaturedToFirestore();
    }
    renderFeaturedSection();
    if (window.renderAdminVideos) renderAdminVideos(videosData);
  });
  onSnapshot(collection(db, "genres"), (snapshot) => {
    userGenres = snapshot.docs.map(doc => doc.data().name);
    populateGenreFilter();
    if (window.renderAdminGenres) renderAdminGenres();
  });
  onSnapshot(doc(db, "site", "featured"), (d) => {
    if (d.exists()) {
      featured = d.data();
      renderFeaturedSection();
      if (window.renderAdminTracks) renderAdminTracks(tracksData);
      if (window.renderAdminVideos) renderAdminVideos(videosData);
    }
  });
}
listenAllFirestore();

// --- FIRESTORE HELPERS ---
async function addTrack({title, artist, genre, audioSrc}) {
  await addDoc(collection(db, "tracks"), { title, artist, genre, audioSrc });
}
async function updateTrack(id, data) {
  await updateDoc(doc(db, "tracks", id), data);
}
async function deleteTrack(id) {
  await deleteDoc(doc(db, "tracks", id));
}
async function addVideo({title, genre, thumbnail, videoSrc}) {
  await addDoc(collection(db, "videos"), { title, genre, thumbnail, videoSrc });
}
async function updateVideo(id, data) {
  await updateDoc(doc(db, "videos", id), data);
}
async function deleteVideo(id) {
  await deleteDoc(doc(db, "videos", id));
}
async function addGenre(name) {
  if (!userGenres.includes(name)) await addDoc(collection(db, "genres"), { name });
}
async function deleteGenre(name) {
  const snap = await getDocs(collection(db, "genres"));
  snap.forEach(docu => { if (docu.data().name === name) deleteDoc(doc(db, "genres", docu.id)); });
}
async function saveFeaturedToFirestore() {
  await setDoc(doc(db, "site", "featured"), featured);
}

// --- TRANSLATIONS and GENRE DATA ---
const translations = {
  en: {
    start: "Start", reviews: "Reviews", interviews: "Interviews", music: "Music", events: "Events", team: "Team", contact: "Contact",
    "featured-artist": "Featured Artist", "featured-artist-desc": "Electronic synthwave music producer.",
    "filter-genre-label": "Filter by genre:", tracks: "Tracks", videos: "Videos", "Music": "Music", "Tracks": "Tracks", "Videos": "Videos",
    "Featured Artist": "Featured Artist", "Electronic synthwave music producer.": "Electronic synthwave music producer.",
    "Filter by genre:": "Filter by genre:", "Search...": "Search...", "All genres": "All genres", "No results found.": "No results found.",
    "Featured": "Featured", "add-genre": "Add Genre", "new-genre-placeholder": "New genre name...", "add-genre-btn": "Add"
  },
  pl: {
    start: "Start", reviews: "Recenzje", interviews: "Wywiady", music: "Muzyka", events: "Wydarzenia", team: "Zespół", contact: "Kontakt",
    "featured-artist": "Wyróżniony artysta", "featured-artist-desc": "Producent elektronicznej muzyki synthwave.",
    "filter-genre-label": "Filtruj według gatunku:", tracks: "Utwory", videos: "Wideo", "Music": "Muzyka", "Tracks": "Utwory", "Videos": "Wideo",
    "Featured Artist": "Wyróżniony artysta", "Electronic synthwave music producer.": "Producent elektronicznej muzyki synthwave.",
    "Filter by genre:": "Filtruj według gatunku:", "Search...": "Szukaj...", "All genres": "Wszystkie gatunki", "No results found.": "Brak wyników.",
    "Featured": "Wyróżniony", "add-genre": "Dodaj gatunek", "new-genre-placeholder": "Nazwa nowego gatunku...", "add-genre-btn": "Dodaj"
  }
};
let currentLang = 'en';
const standardGenreKeysDefault = [
  "Synthwave", "Retrowave", "Chillwave", "Pop", "Rock", "Hip-Hop", "Jazz", "Classical",
  "Ambient", "Electronic", "Indie", "Funk", "Soul", "Disco", "Trance", "EDM",
  "House", "Dubstep", "Lo-fi", "Reggae", "Country", "Metal"
];
const genreTranslations = {
  en: Object.fromEntries(standardGenreKeysDefault.map(g => [g, g])),
  pl: {
    "Synthwave": "Synthwave", "Retrowave": "Retrowave", "Chillwave": "Chillwave",
    "Pop": "Pop","Rock": "Rock","Hip-Hop": "Hip-Hop","Jazz": "Jazz","Classical": "Klasyczna",
    "Ambient": "Ambient","Electronic": "Elektroniczna","Indie": "Indie","Funk": "Funk",
    "Soul": "Soul","Disco": "Disco","Trance": "Trance","EDM": "EDM","House": "House",
    "Dubstep": "Dubstep","Lo-fi": "Lo-fi","Reggae": "Reggae","Country": "Country","Metal": "Metal"
  }
};
const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");

// --- LANGUAGE, FILTER, GENRE, AND UI UTILS ---
function allGenreKeys() {
  return [...new Set([...standardGenreKeysDefault, ...userGenres])];
}
function t(key) {
  return (translations[currentLang] && translations[currentLang][key]) || key;
}
function genreT(genre) {
  return (genreTranslations[currentLang] && genreTranslations[currentLang][genre]) || genre;
}
function setLang(lang) {
  currentLang = lang;
  document.querySelectorAll('.lang-buttons button').forEach(btn => btn.classList.remove('active'));
  document.getElementById('btn-' + lang).classList.add('active');
  document.querySelectorAll('[data-key]').forEach(el => {
    const k = el.getAttribute('data-key');
    if (translations[lang][k]) el.innerText = translations[lang][k];
  });
  document.getElementById('search-bar').placeholder = t('Search...');
  populateGenreFilter();
  displayTracks();
  displayVideos();
  updateTracksPagination();
  updateVideosPagination();
}
document.getElementById('btn-en').onclick = () => setLang('en');
document.getElementById('btn-pl').onclick = () => setLang('pl');

function renderFeaturedSection() {
  const sec = document.getElementById("featured-section");
  sec.innerHTML = "";
  let html = "";
  if (featured.type === "track" && tracksData.length > 0) {
    const track = tracksData.find(t => t.id === featured.id) || tracksData[0];
    if (!track) return;
    html = `
      <img src="https://img.icons8.com/color/96/000000/musical-notes.png" class="featured-thumb" style="background:#121425" />
      <div class="featured-info">
        <h2>${escapeHTML(track.title)} <span class="track-genre">${genreT(track.genre)}</span></h2>
        <p>${escapeHTML(track.artist || "")}</p>
        <audio class="track-audio" controls src="${track.audioSrc}"></audio>
      </div>
    `;
  } else if (featured.type === "video" && videosData.length > 0) {
    const video = videosData.find(v => v.id === featured.id) || videosData[0];
    if (!video) return;
    html = `
      <img src="${getYoutubeThumb(video)}" class="featured-thumb" style="background:#121425" tabindex="0" onclick="showVideoModal('${video.videoSrc}')" />
      <div class="featured-info">
        <h2>${escapeHTML(video.title)} <span class="track-genre">${genreT(video.genre)}</span></h2>
        <button onclick="showVideoModal('${video.videoSrc}')" style="background:#00ffff;color:#232949;border:none;padding:0.4em 1em;border-radius:4px;cursor:pointer;margin-top:0.7em;font-weight:bold;">Play Video</button>
      </div>
    `;
  } else {
    html = `<div class="featured-info"><h2>${t("featured-artist")}</h2><p>${t("featured-artist-desc")}</p></div>`;
  }
  sec.innerHTML = html;
}

function populateGenreFilter() {
  const select = document.getElementById('genre-filter');
  let genres = allGenreKeys();
  select.innerHTML = `<option value="">${t("All genres")}</option>` +
    genres.map(g => `<option value="${escapeHTML(g)}">${genreT(g)}</option>`).join('');
}

function renderAlphabetFilter() {
  const wrap = document.getElementById("alphabet-filter");
  wrap.innerHTML = "";
  alphabet.forEach(ltr => {
    const btn = document.createElement("button");
    btn.textContent = ltr;
    btn.onclick = () => {
      document.querySelectorAll("#alphabet-filter button").forEach(b=>b.classList.remove("active"));
      btn.classList.add("active");
      document.getElementById("search-bar").value="";
      document.getElementById("genre-filter").value="";
      tracksPage = 1;
      displayTracks(ltr);
      updateTracksPagination();
    };
    wrap.appendChild(btn);
  });
  const allBtn = document.createElement("button");
  allBtn.textContent = "All";
  allBtn.onclick = () => {
    document.querySelectorAll("#alphabet-filter button").forEach(b=>b.classList.remove("active"));
    allBtn.classList.add("active");
    tracksPage = 1;
    displayTracks();
    updateTracksPagination();
  };
  wrap.appendChild(allBtn);
}
renderAlphabetFilter();

function escapeHTML(str) {
  if (!str) return "";
  return str.replace(/[<>&"']/g, c => (
    { '<':'&lt;', '>':'&gt;', '&':'&amp;', '"':'&quot;', "'":'&#39;' }[c]
  ));
}
function getYoutubeThumb(video) {
  if (video.thumbnail && video.thumbnail.trim()) return video.thumbnail;
  let match = (video.videoSrc || "").match(/embed\/([a-zA-Z0-9_-]+)/);
  if (!match && video.videoSrc) {
    match = video.videoSrc.match(/(?:watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]+)/);
  }
  if (match) {
    return `https://i.ytimg.com/vi/${match[1]}/hqdefault.jpg`;
  }
  return '';
}

// --- DISPLAY + PAGINATION ---
function displayTracks(alpha) {
  let search = document.getElementById("search-bar").value.toLowerCase();
  let genre = document.getElementById("genre-filter").value;
  let filtered = tracksData.filter(track =>
    (!search || track.title.toLowerCase().includes(search) || (track.artist && track.artist.toLowerCase().includes(search))) &&
    (!genre || track.genre === genre) &&
    (!alpha || (track.title[0] && track.title[0].toUpperCase() === alpha))
  );
  const container = document.getElementById("tracks-container");
  const totalPages = Math.max(1, Math.ceil(filtered.length / TRACKS_PER_PAGE));
  if (tracksPage > totalPages) tracksPage = 1;
  if (!filtered.length) {
    container.innerHTML = `<div style="color:#fff;">${t("No results found.")}</div>`;
    document.getElementById("tracks-pagination").innerHTML = "";
    return;
  }
  const start = (tracksPage - 1) * TRACKS_PER_PAGE;
  const end = start + TRACKS_PER_PAGE;
  let html = "";
  filtered.slice(start, end).forEach((track) => {
    html += `<div class="track-item">
      <div class="track-info">
        <div class="track-title">
          ${escapeHTML(track.title)}
          <span class="track-genre">${genreT(track.genre)}</span>
        </div>
        <div class="track-artist">${escapeHTML(track.artist||"")}</div>
      </div>
      <audio class="track-audio" controls src="${track.audioSrc}"></audio>
    </div>`;
  });
  container.innerHTML = html;
  updateTracksPagination(filtered.length);
}
function displayVideos() {
  let search = document.getElementById("search-bar").value.toLowerCase();
  let genre = document.getElementById("genre-filter").value;
  let filtered = videosData.filter(video =>
    (!search || video.title.toLowerCase().includes(search)) &&
    (!genre || video.genre === genre)
  );
  const container = document.getElementById("videos-container");
  const totalPages = Math.max(1, Math.ceil(filtered.length / VIDEOS_PER_PAGE));
  if (videosPage > totalPages) videosPage = 1;
  if (!filtered.length) {
    container.innerHTML = `<div style="color:#fff;">${t("No results found.")}</div>`;
    document.getElementById("videos-pagination").innerHTML = "";
    return;
  }
  const start = (videosPage - 1) * VIDEOS_PER_PAGE;
  const end = start + VIDEOS_PER_PAGE;
  let html = "";
  filtered.slice(start, end).forEach((video) => {
    html += `<img src="${getYoutubeThumb(video)}" class="video-thumb" tabindex="0" onclick="showVideoModal('${video.videoSrc}')" alt="${escapeHTML(video.title)}"/>`;
  });
  container.innerHTML = html;
  updateVideosPagination(filtered.length);
}
window.showVideoModal = function(videoSrc) {
  function toEmbed(url) {
    if (url.includes('/embed/')) return url;
    const short = url.match(/youtu\.be\/([a-zA-Z0-9_-]+)/);
    if (short) return `https://www.youtube.com/embed/${short[1]}`;
    const watch = url.match(/[?&]v=([a-zA-Z0-9_-]+)/);
    if (watch) return `https://www.youtube.com/embed/${watch[1]}`;
    const watch2 = url.match(/youtube\.com\/watch\?v=([a-zA-Z0-9_-]+)/);
    if (watch2) return `https://www.youtube.com/embed/${watch2[1]}`;
    return url;
  }
  const embedUrl = toEmbed(videoSrc);
  const modal = document.getElementById("video-modal");
  modal.innerHTML = `
    <button class="close-btn" onclick="closeVideoModal()" aria-label="Close">&times;</button>
    <div style="max-width:90vw;max-height:80vh;">
      <iframe src="${embedUrl}" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen style="width:600px;max-width:90vw;height:340px;max-height:80vh;border-radius:10px;background:#000;display:block;"></iframe>
    </div>
  `;
  modal.classList.add("active");
  modal.style.display = "flex";
};
window.closeVideoModal = function() {
  const modal = document.getElementById("video-modal");
  modal.innerHTML = "";
  modal.classList.remove("active");
  modal.style.display = "none";
};
document.getElementById("search-bar").oninput = () => { tracksPage = 1; videosPage = 1; displayTracks(); displayVideos(); updateTracksPagination(); updateVideosPagination(); };
document.getElementById("genre-filter").onchange = () => { tracksPage = 1; videosPage = 1; displayTracks(); displayVideos(); updateTracksPagination(); updateVideosPagination(); };

// PAGINATION CONTROLS
function updateTracksPagination(filteredLen) {
  let search = document.getElementById("search-bar").value.toLowerCase();
  let genre = document.getElementById("genre-filter").value;
  let alphaBtn = document.querySelector("#alphabet-filter button.active");
  let alpha = alphaBtn && alphaBtn.textContent !== "All" ? alphaBtn.textContent : "";
  let filtered = tracksData.filter(track =>
    (!search || track.title.toLowerCase().includes(search) || (track.artist && track.artist.toLowerCase().includes(search))) &&
    (!genre || track.genre === genre) &&
    (!alpha || (track.title[0] && track.title[0].toUpperCase() === alpha))
  );
  const totalPages = Math.max(1, Math.ceil(filtered.length / TRACKS_PER_PAGE));
  if (tracksPage > totalPages) tracksPage = 1;
  let pag = document.getElementById("tracks-pagination");
  if (filtered.length <= TRACKS_PER_PAGE) { pag.innerHTML = ""; return; }
  let buttons = '';
  if (tracksPage > 1) buttons += `<button onclick="tracksPrevPage()" style="margin-right:8px;">&laquo; Prev</button>`;
  for (let p = 1; p <= totalPages; ++p) {
    buttons += `<button onclick="tracksSetPage(${p})" ${p===tracksPage?'style="font-weight:bold;background:#00ffff;color:#232949;"':''}>${p}</button> `;
  }
  if (tracksPage < totalPages) buttons += `<button onclick="tracksNextPage()" style="margin-left:8px;">Next &raquo;</button>`;
  pag.innerHTML = buttons;
}
window.tracksPrevPage = function() { if (tracksPage > 1) { tracksPage--; displayTracks(); updateTracksPagination(); } };
window.tracksNextPage = function() { 
  let search = document.getElementById("search-bar").value.toLowerCase();
  let genre = document.getElementById("genre-filter").value;
  let alphaBtn = document.querySelector("#alphabet-filter button.active");
  let alpha = alphaBtn && alphaBtn.textContent !== "All" ? alphaBtn.textContent : "";
  let filtered = tracksData.filter(track =>
    (!search || track.title.toLowerCase().includes(search) || (track.artist && track.artist.toLowerCase().includes(search))) &&
    (!genre || track.genre === genre) &&
    (!alpha || (track.title[0] && track.title[0].toUpperCase() === alpha))
  );
  const totalPages = Math.max(1, Math.ceil(filtered.length / TRACKS_PER_PAGE));
  if (tracksPage < totalPages) { tracksPage++; displayTracks(); updateTracksPagination(); }
};
window.tracksSetPage = function(p) { tracksPage = p; displayTracks(); updateTracksPagination(); };

function updateVideosPagination(filteredLen) {
  let search = document.getElementById("search-bar").value.toLowerCase();
  let genre = document.getElementById("genre-filter").value;
  let filtered = videosData.filter(video =>
    (!search || video.title.toLowerCase().includes(search)) &&
    (!genre || video.genre === genre)
  );
  const totalPages = Math.max(1, Math.ceil(filtered.length / VIDEOS_PER_PAGE));
  if (videosPage > totalPages) videosPage = 1;
  let pag = document.getElementById("videos-pagination");
  if (filtered.length <= VIDEOS_PER_PAGE) { pag.innerHTML = ""; return; }
  let buttons = '';
  if (videosPage > 1) buttons += `<button onclick="videosPrevPage()" style="margin-right:8px;">&laquo; Prev</button>`;
  for (let p = 1; p <= totalPages; ++p) {
    buttons += `<button onclick="videosSetPage(${p})" ${p===videosPage?'style="font-weight:bold;background:#00ffff;color:#232949;"':''}>${p}</button> `;
  }
  if (videosPage < totalPages) buttons += `<button onclick="videosNextPage()" style="margin-left:8px;">Next &raquo;</button>`;
  pag.innerHTML = buttons;
}
window.videosPrevPage = function() { if (videosPage > 1) { videosPage--; displayVideos(); updateVideosPagination(); } };
window.videosNextPage = function() { 
  let search = document.getElementById("search-bar").value.toLowerCase();
  let genre = document.getElementById("genre-filter").value;
  let filtered = videosData.filter(video =>
    (!search || video.title.toLowerCase().includes(search)) &&
    (!genre || video.genre === genre)
  );
  const totalPages = Math.max(1, Math.ceil(filtered.length / VIDEOS_PER_PAGE));
  if (videosPage < totalPages) { videosPage++; displayVideos(); updateVideosPagination(); }
};
window.videosSetPage = function(p) { videosPage = p; displayVideos(); updateVideosPagination(); };

// --- ADMIN PANEL ---
window.renderAdminTracks = function(tracks) {
  const sec = document.getElementById("admin-section-tracks");
  sec.innerHTML = `
    <form id="admin-track-form" class="admin-form">
      <div>
        <label>Title</label>
        <input type="text" id="adm-track-title" required autocomplete="off"/>
        <label>Artist</label>
        <input type="text" id="adm-track-artist" required autocomplete="off"/>
        <label>Genre</label>
        <select id="adm-track-genre">${allGenreKeys().map(g => `<option value="${escapeHTML(g)}">${genreT(g)}</option>`)}</select>
        <label>Audio Link</label>
        <input type="url" id="adm-track-src" required autocomplete="off"/>
      </div>
      <button type="submit" class="admin-btn">Add Track</button>
      <button type="button" class="admin-btn" style="display:none;" id="adm-track-cancel">Cancel</button>
      <input type="hidden" id="adm-track-edit-id" value=""/>
    </form>
    <table class="admin-list-table" style="margin-top:1.4em;">
      <thead>
        <tr>
          <th></th>
          <th>#</th><th>Title</th><th>Artist</th><th>Genre</th><th>Audio Link</th><th>Actions</th>
        </tr>
      </thead>
      <tbody id="admin-tracks-tbody"></tbody>
    </table>
  `;
  const tbody = sec.querySelector("#admin-tracks-tbody");
  tbody.innerHTML = tracks.map((t, i) => `
    <tr>
      <td>
        <button class="admin-btn featured${(featured.type==="track" && featured.id==t.id)?" selected":""}" onclick="makeFeaturedTrack('${t.id}');return false;" title="Make Featured Track">⭐</button>
      </td>
      <td>${i+1}</td>
      <td>${escapeHTML(t.title)}</td>
      <td>${escapeHTML(t.artist)}</td>
      <td>${escapeHTML(t.genre)}</td>
      <td><a href="${t.audioSrc}" target="_blank" style="color:#00ffff;">Audio</a></td>
      <td>
        <button class="admin-btn" onclick="editTrack('${t.id}')">Edit</button>
        <button class="admin-btn delete" onclick="deleteTrack('${t.id}')">Delete</button>
      </td>
    </tr>
  `).join('');
  const form = sec.querySelector("#admin-track-form");
  form.onsubmit = async e => {
    e.preventDefault();
    const title = form['adm-track-title'].value.trim();
    const artist = form['adm-track-artist'].value.trim();
    const genre = form['adm-track-genre'].value;
    const audioSrc = form['adm-track-src'].value.trim();
    const id = form['adm-track-edit-id'].value;
    if (!id) { await addTrack({ title, artist, genre, audioSrc }); }
    else { await updateTrack(id, { title, artist, genre, audioSrc }); }
    form.reset();
    sec.querySelector("#adm-track-cancel").style.display = "none";
    form['adm-track-edit-id'].value = "";
    form.querySelector("button[type=submit]").textContent = "Add Track";
  };
  sec.querySelector("#adm-track-cancel").onclick = () => {
    form.reset();
    sec.querySelector("#adm-track-cancel").style.display = "none";
    form['adm-track-edit-id'].value = "";
    form.querySelector("button[type=submit]").textContent = "Add Track";
  };
  window.editTrack = function(id) {
    const t = tracksData.find(x => x.id === id);
    if (!t) return;
    form['adm-track-title'].value = t.title || '';
    form['adm-track-artist'].value = t.artist || '';
    form.querySelector('#adm-track-genre').value = t.genre || '';
    form['adm-track-src'].value = t.audioSrc || '';
    form['adm-track-edit-id'].value = id;
    form.querySelector("button[type=submit]").textContent = "Save";
    sec.querySelector("#adm-track-cancel").style.display = "";
  };
  window.deleteTrack = async function(id) {
    if (!confirm("Delete this track?")) return;
    await deleteTrack(id);
  };
  window.makeFeaturedTrack = async function(id) {
    featured = { type: "track", id };
    await saveFeaturedToFirestore();
  };
};
window.renderAdminVideos = function(videos) {
  const sec = document.getElementById("admin-section-videos");
  sec.innerHTML = `
    <form id="admin-video-form" class="admin-form">
      <div>
        <label>Title</label>
        <input type="text" id="adm-video-title" required autocomplete="off"/>
        <label>Genre</label>
        <select id="adm-video-genre">${allGenreKeys().map(g => `<option value="${escapeHTML(g)}">${genreT(g)}</option>`)}</select>
        <label>Video Link (YouTube or embed or youtu.be)</label>
        <input type="url" id="adm-video-src" required autocomplete="off"/>
        <label>Thumbnail Link (optional, auto from YouTube if blank)</label>
        <input type="url" id="adm-video-thumb" autocomplete="off"/>
      </div>
      <button type="submit" class="admin-btn">Add Video</button>
      <button type="button" class="admin-btn" style="display:none;" id="adm-video-cancel">Cancel</button>
      <input type="hidden" id="adm-video-edit-id" value=""/>
    </form>
    <table class="admin-list-table" style="margin-top:1.4em;">
      <thead>
        <tr>
          <th></th>
          <th>#</th><th>Title</th><th>Genre</th><th>Thumbnail</th><th>Video Link</th><th>Actions</th>
        </tr>
      </thead>
      <tbody id="admin-videos-tbody"></tbody>
    </table>
  `;
  const tbody = sec.querySelector("#admin-videos-tbody");
  tbody.innerHTML = videos.map((v, i) => `
    <tr>
      <td>
        <button class="admin-btn featured${(featured.type==="video" && featured.id==v.id)?" selected":""}" onclick="makeFeaturedVideo('${v.id}');return false;" title="Make Featured Video">⭐</button>
      </td>
      <td>${i+1}</td>
      <td>${escapeHTML(v.title)}</td>
      <td>${escapeHTML(v.genre)}</td>
      <td><img src="${getYoutubeThumb(v)}" alt="thumb" style="width:62px; border-radius:5px;"/></td>
      <td><a href="${v.videoSrc}" target="_blank" style="color:#00ffff;">Video</a></td>
      <td>
        <button class="admin-btn" onclick="editVideo('${v.id}')">Edit</button>
        <button class="admin-btn delete" onclick="deleteVideo('${v.id}')">Delete</button>
      </td>
    </tr>
  `).join('');
  const form = sec.querySelector("#admin-video-form");
  form.onsubmit = async e => {
    e.preventDefault();
    const title = form['adm-video-title'].value.trim();
    const genre = form['adm-video-genre'].value;
    let thumb = form['adm-video-thumb'].value.trim();
    let src = form['adm-video-src'].value.trim();
    let youtubeId = "";
    const ytMatch = src.match(/(?:youtu\.be\/|youtube\.com\/(?:watch\?v=|embed\/))([a-zA-Z0-9_-]+)/);
    if (ytMatch) {
      youtubeId = ytMatch[1];
      src = `https://www.youtube.com/embed/${youtubeId}`;
      if (!thumb) {
        thumb = `https://i.ytimg.com/vi/${youtubeId}/hqdefault.jpg`;
      }
    }
    const id = form['adm-video-edit-id'].value;
    if (!id) { await addVideo({ title, genre, thumbnail: thumb, videoSrc: src }); }
    else { await updateVideo(id, { title, genre, thumbnail: thumb, videoSrc: src }); }
    form.reset();
    sec.querySelector("#adm-video-cancel").style.display = "none";
    form['adm-video-edit-id'].value = "";
    form.querySelector("button[type=submit]").textContent = "Add Video";
  };
  sec.querySelector("#adm-video-cancel").onclick = () => {
    form.reset();
    sec.querySelector("#adm-video-cancel").style.display = "none";
    form['adm-video-edit-id'].value = "";
    form.querySelector("button[type=submit]").textContent = "Add Video";
  };
  window.editVideo = function(id) {
    const v = videosData.find(x => x.id === id);
    if (!v) return;
    form['adm-video-title'].value = v.title || '';
    form.querySelector('#adm-video-genre').value = v.genre || '';
    form['adm-video-thumb'].value = v.thumbnail || '';
    form['adm-video-src'].value = v.videoSrc || '';
    form['adm-video-edit-id'].value = id;
    form.querySelector("button[type=submit]").textContent = "Save";
    sec.querySelector("#adm-video-cancel").style.display = "";
  };
  window.deleteVideo = async function(id) {
    if (!confirm("Delete this video?")) return;
    await deleteVideo(id);
  };
  window.makeFeaturedVideo = async function(id) {
    featured = { type: "video", id };
    await saveFeaturedToFirestore();
  };
};
window.renderAdminGenres = function() {
  const sec = document.getElementById("admin-section-genres");
  sec.innerHTML = `
    <form id="admin-genre-form" class="admin-form" style="margin-bottom:1.2em;">
      <input id="new-genre-name" type="text" placeholder="${t("new-genre-placeholder")}" required/>
      <button type="submit" class="admin-btn">${t("add-genre-btn")}</button>
    </form>
    <ul style="color:#fff;list-style:none;padding:0;">
      ${userGenres.map((g,i) => `
        <li>
          ${escapeHTML(g)}
          <button class="admin-btn delete" onclick="removeUserGenre('${g}')">Delete</button>
        </li>
      `).join('')}
    </ul>
  `;
  sec.querySelector("#admin-genre-form").onsubmit = async e => {
    e.preventDefault();
    const name = sec.querySelector("#new-genre-name").value.trim();
    if (!name) return;
    await addGenre(name);
  };
  window.removeUserGenre = async function(name) {
    await deleteGenre(name);
  };
};

function renderAdmin() {
  const overlay = document.getElementById("admin-modal-overlay");
  const inner = document.getElementById("admin-modal-inner");
  inner.innerHTML = `
    <h2 style="color:#00ffff;">Admin Panel</h2>
    <div id="admin-tabs">
      <button class="admin-tab-btn" data-tab="tracks">Tracks</button>
      <button class="admin-tab-btn" data-tab="videos">Videos</button>
      <button class="admin-tab-btn" data-tab="genres">Genres</button>
    </div>
    <div id="admin-section-tracks" class="admin-tab-section"></div>
    <div id="admin-section-videos" class="admin-tab-section" style="display:none"></div>
    <div id="admin-section-genres" class="admin-tab-section" style="display:none"></div>
    <button onclick="closeAdmin()" style="margin-top:2em;background:#00ffff;color:#232949;border:none;padding:0.6em 1.5em;font-size:1.1em;border-radius:5px;cursor:pointer;">Close</button>
    <style>
      .admin-tab-btn {margin-right:0.8em;background:#181c2f;color:#fff;border:none;padding:0.45em 1.2em;font-size:1em;cursor:pointer;border-radius:4px;}
      .admin-tab-btn.active {background:#00ffff;color:#181c2f;font-weight:bold;}
      .admin-list-table {width:100%;margin-top:1em;border-collapse:collapse;background:#232949;}
      .admin-list-table th, .admin-list-table td {padding:0.5em;color:#fff;border:1px solid #111;}
      .admin-btn {background:#00ffff;color:#232949;border:none;padding:0.3em 0.7em;border-radius:4px;cursor:pointer;}
      .admin-btn.delete {background:red;color:#fff;}
      .admin-btn.featured.selected {background:#ff0;color:#222;}
      .admin-form input, .admin-form select {margin-right:0.7em;margin-bottom:0.6em;}
    </style>
  `;
  function switchTab(tab) {
    inner.querySelectorAll('.admin-tab-btn').forEach(btn=>btn.classList.remove('active'));
    inner.querySelector(`.admin-tab-btn[data-tab="${tab}"]`).classList.add('active');
    inner.querySelectorAll('.admin-tab-section').forEach(s=>s.style.display='none');
    inner.querySelector('#admin-section-'+tab).style.display = '';
  }
  inner.querySelectorAll('.admin-tab-btn').forEach(btn=>{
    btn.onclick = ()=>switchTab(btn.dataset.tab);
  });
  switchTab('tracks');
  window.renderAdminTracks(tracksData);
  window.renderAdminVideos(videosData);
  window.renderAdminGenres();
  overlay.style.display = "flex";
}
function closeAdmin() {
  document.getElementById("admin-modal-overlay").style.display = "none";
}
document.getElementById("admin-modal-overlay").onclick = function(e){
  if (e.target === this) closeAdmin();
};

// --- Password protection for admin ---
const ADMIN_PASSWORD = "wajbzz123";
function promptAdminPasswordAndOpen() {
  if (sessionStorage.getItem("adminAuth") === "ok") {
    renderAdmin();
    return;
  }
  const entered = prompt("Enter admin password:");
  if (entered === ADMIN_PASSWORD) {
    sessionStorage.setItem("adminAuth", "ok");
    renderAdmin();
  } else if (entered !== null) {
    alert("Incorrect password.");
  }
}
document.getElementById("admin-settings-trigger").onclick = promptAdminPasswordAndOpen;

// --- INITIALIZE ---
populateGenreFilter();
renderFeaturedSection();
displayTracks();
displayVideos();</script>
</body>
</html>
